{
  "version": 3,
  "sources": ["stat.store.ts"],
  "sourcesContent": ["import { Stat, STORAGE_KEY_TO_STAT_PROPERTY, STORAGE_KEY_MAPPING } from '@ts/types';\r\n\r\n/**\r\n * Reactive stat store for managing character stats\r\n */\r\nclass StatStore {\r\n    private stats: Stat = this.getInitialStats();\r\n    private listeners: Set<(stats: Stat) => void> = new Set();\r\n\r\n    private getInitialStats(): Stat {\r\n        return {\r\n            attack: '0',\r\n            critRate: '0',\r\n            critDamage: '0',\r\n            statDamage: '0',\r\n            damage: '0',\r\n            damageAmp: '0',\r\n            attackSpeed: '0',\r\n            defPen: '0',\r\n            bossDamage: '0',\r\n            normalDamage: '0',\r\n            skillCoeff: '0',\r\n            skillMastery: '0',\r\n            skillMasteryBoss: '0',\r\n            minDamage: '0',\r\n            maxDamage: '0',\r\n            primaryMainStat: '0',\r\n            secondaryMainStat: '0',\r\n            finalDamage: '0',\r\n            targetStage: '',\r\n            defense: '0',\r\n            mainStatPct: '0',\r\n            skillLevel1st: '0',\r\n            skillLevel2nd: '0',\r\n            skillLevel3rd: '0',\r\n            skillLevel4th: '0',\r\n            str: '0',\r\n            dex: '0',\r\n            int: '0',\r\n            luk: '0',\r\n            characterLevel: '0'\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Load stats from localStorage and populate the store\r\n     * Maps localStorage keys (with hyphens) to camelCase Stat properties\r\n     */\r\n    loadStatsFromLocalStorage(): boolean {\r\n        const savedData = localStorage.getItem('damageCalculatorData');\r\n        if (!savedData) {\r\n            return false;\r\n        }\r\n\r\n        try {\r\n            const data = JSON.parse(savedData);\r\n\r\n            if (data.baseSetup) {\r\n                // Map localStorage keys to Stat properties and merge into store\r\n                Object.keys(data.baseSetup).forEach((storageKey) => {\r\n                    const statKey = STORAGE_KEY_TO_STAT_PROPERTY[storageKey];\r\n                    if (statKey && statKey in this.stats) {\r\n                        this.stats[statKey] = data.baseSetup[storageKey];\r\n                    }\r\n                });\r\n\r\n                // Notify all listeners of the update\r\n                this.notify();\r\n\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        } catch (e) {\r\n            console.error('Error loading stats from localStorage:', e);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the current stats object\r\n     */\r\n    getStats(): Stat {\r\n        return { ...this.stats };\r\n    }\r\n\r\n    /**\r\n     * Get a specific stat value\r\n     */\r\n    getStat<K extends keyof Stat>(key: K): Stat[K] {\r\n        return this.stats[key];\r\n    }\r\n\r\n    /**\r\n     * Update a specific stat value\r\n     */\r\n    setStat<K extends keyof Stat>(key: K, value: Stat[K]): void {\r\n        this.stats[key] = value;\r\n        this.notify();\r\n    }\r\n\r\n    /**\r\n     * Update multiple stats at once\r\n     */\r\n    setStats(updates: Partial<Stat>): void {\r\n        Object.keys(updates).forEach((key) => {\r\n            if (key in this.stats) {\r\n                this.stats[key as keyof Stat] = updates[key as keyof Stat]!;\r\n            }\r\n        });\r\n        this.notify();\r\n    }\r\n\r\n    /**\r\n     * Sync stats from DOM elements (useful for manual refresh)\r\n     * Maps DOM element IDs (with hyphens and -base suffix) to camelCase Stat properties\r\n     */\r\n    syncFromDOM(): void {\r\n        // Iterate through all stat properties and sync from corresponding DOM elements\r\n        Object.entries(STORAGE_KEY_MAPPING).forEach(([statKey, storageKey]) => {\r\n            // Most elements have -base suffix, character-level does not\r\n            const elementId = statKey === 'characterLevel'\r\n                ? storageKey\r\n                : `${storageKey}-base`;\r\n\r\n            const element = document.getElementById(elementId);\r\n            if (element) {\r\n                this.stats[statKey as keyof Stat] = element.innerText;\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Subscribe to stat changes\r\n     * @returns Unsubscribe function\r\n     */\r\n    subscribe(listener: (stats: Stat) => void): () => void {\r\n        this.listeners.add(listener);\r\n        return () => this.listeners.delete(listener);\r\n    }\r\n\r\n    /**\r\n     * Notify all listeners of stat changes\r\n     */\r\n    private notify(): void {\r\n        this.listeners.forEach((listener) => listener(this.getStats()));\r\n    }\r\n\r\n    /**\r\n     * Reset all stats to initial values\r\n     */\r\n    reset(): void {\r\n        this.stats = this.getInitialStats();\r\n        this.notify();\r\n    }\r\n}\r\n\r\n// Export singleton instance\r\nexport const statStore = new StatStore();\r\n\r\n// Also export the class for testing purposes\r\nexport { StatStore };\r\n"],
  "mappings": "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",
  "names": []
}
