{
  "version": 3,
  "sources": ["stat-predictions.ts"],
  "sourcesContent": ["/**\r\n * Stat Predictions Logic\r\n * Business logic for calculating stat damage predictions\r\n * Separated from UI concerns\r\n */\r\n\r\nimport { StatCalculationService } from '@core/services/stat-calculation-service';\r\nimport { MONSTER_TYPE } from '@ts/types/constants';\r\nimport type { StatWeightResult, StatIncrease, StatsObject } from '@ts/types/page/stat-hub/stat-hub.types';\r\n\r\n// Stat key constants for comparisons\r\nconst STAT_DAMAGE_KEY = 'stat-damage';\r\nconst NORMAL_DAMAGE_KEY = 'normal-damage';\r\nconst FINAL_DAMAGE_KEY = 'final-damage';\r\nconst ATTACK_SPEED_KEY = 'attack-speed';\r\nconst DEF_PEN_KEY = 'def-pen';\r\n\r\n// CamelCase versions for StatsObject access\r\nconst STAT_DAMAGE_CAMEL = 'statDamage';\r\nconst NORMAL_DAMAGE_CAMEL = 'normalDamage';\r\nconst FINAL_DAMAGE_CAMEL = 'finalDamage';\r\nconst ATTACK_SPEED_CAMEL = 'attackSpeed';\r\nconst DEF_PEN_CAMEL = 'defPen';\r\n\r\n// Default stat increase values\r\nexport const DEFAULT_STAT_INCREASES: StatIncrease = {\r\n    flat: [500, 1000, 2500, 5000, 10000, 15000],\r\n    mainStat: [100, 500, 1000, 2500, 5000, 7500],\r\n    percentage: [1, 5, 10, 25, 50, 75]\r\n};\r\n\r\n// Percentage stat configuration\r\nexport const PERCENTAGE_STATS = [\r\n    { key: 'skillCoeff', label: 'Skill Coeff' },\r\n    { key: 'skillMastery', label: 'Skill Mastery' },\r\n    { key: 'damage', label: 'Damage' },\r\n    { key: 'finalDamage', label: 'Final Dmg' },\r\n    { key: 'bossDamage', label: 'Boss Dmg' },\r\n    { key: 'normalDamage', label: 'Mob Dmg' },\r\n    { key: 'statDamage', label: 'Main Stat %' },\r\n    { key: 'damageAmp', label: 'Dmg Amp' },\r\n    { key: 'minDamage', label: 'Min Dmg' },\r\n    { key: 'maxDamage', label: 'Max Dmg' },\r\n    { key: 'critRate', label: 'Crit Rate' },\r\n    { key: 'critDamage', label: 'Crit Dmg' },\r\n    { key: 'attackSpeed', label: 'Atk Speed' },\r\n    { key: 'defPen', label: 'Def Pen' }\r\n];\r\n\r\n// Multiplicative stats (applied multiplicatively)\r\nexport const MULTIPLICATIVE_STATS: Record<string, boolean> = {\r\n    [FINAL_DAMAGE_CAMEL]: true\r\n};\r\n\r\n// Diminishing return stats with their denominator values\r\nexport const DIMINISHING_RETURN_STATS: Record<string, { denominator: number }> = {\r\n    [ATTACK_SPEED_CAMEL]: { denominator: 150 },\r\n    [DEF_PEN_CAMEL]: { denominator: 100 }\r\n};\r\n\r\n/**\r\n * Calculate attack stat weights\r\n * Returns array of weight results for each increase value\r\n */\r\nexport function calculateAttackWeights(\r\n    stats: StatsObject,\r\n    baseBossDPS: number,\r\n    increases: number[]\r\n): StatWeightResult[] {\r\n    const results: StatWeightResult[] = [];\r\n\r\n    increases.forEach(increase => {\r\n        const service = new StatCalculationService(stats);\r\n        const oldValue = stats.attack;\r\n        const effectiveIncrease = increase * (1 + service.weaponAttackBonus / 100);\r\n\r\n        const newDPS = service.addAttack(increase).computeDPS(MONSTER_TYPE.BOSS);\r\n        const newValue = service.getStats().attack;\r\n        const gainPercentage = (newDPS - baseBossDPS) / baseBossDPS * 100;\r\n\r\n        results.push({\r\n            statLabel: 'Attack',\r\n            increase,\r\n            oldDPS: baseBossDPS,\r\n            newDPS,\r\n            gainPercentage,\r\n            effectiveIncrease,\r\n            oldValue,\r\n            newValue\r\n        });\r\n    });\r\n\r\n    return results;\r\n}\r\n\r\n/**\r\n * Calculate main stat weights\r\n * Returns array of weight results for each increase value\r\n */\r\nexport function calculateMainStatWeights(\r\n    stats: StatsObject,\r\n    baseBossDPS: number,\r\n    increases: number[]\r\n): StatWeightResult[] {\r\n    const results: StatWeightResult[] = [];\r\n\r\n    increases.forEach(increase => {\r\n        const service = new StatCalculationService(stats);\r\n        const actualMainStatGain = service.calculateMainStatIncreaseWithPct(increase);\r\n\r\n        const newDPS = service.addMainStat(increase).computeDPS(MONSTER_TYPE.BOSS);\r\n        const gainPercentage = (newDPS - baseBossDPS) / baseBossDPS * 100;\r\n\r\n        results.push({\r\n            statLabel: 'Main Stat',\r\n            increase: actualMainStatGain,\r\n            oldDPS: baseBossDPS,\r\n            newDPS,\r\n            gainPercentage,\r\n            effectiveIncrease: actualMainStatGain\r\n        });\r\n    });\r\n\r\n    return results;\r\n}\r\n\r\n/**\r\n * Calculate percentage stat weights for a specific stat\r\n * Returns array of weight results for each increase value\r\n */\r\nexport function calculatePercentageStatWeight(\r\n    stats: StatsObject,\r\n    baseBossDPS: number,\r\n    baseNormalDPS: number,\r\n    statKey: string,\r\n    increases: number[]\r\n): StatWeightResult[] {\r\n    const results: StatWeightResult[] = [];\r\n    const isNormalDamage = statKey === NORMAL_DAMAGE_CAMEL;\r\n    const baseDPS = isNormalDamage ? baseNormalDPS : baseBossDPS;\r\n\r\n    increases.forEach(increase => {\r\n        const service = new StatCalculationService(stats);\r\n\r\n        // Apply the stat increase based on type\r\n        if (statKey === STAT_DAMAGE_CAMEL) {\r\n            service.addMainStatPct(increase);\r\n        } else if (MULTIPLICATIVE_STATS[statKey]) {\r\n            service.addMultiplicativeStat(statKey, increase);\r\n        } else if (DIMINISHING_RETURN_STATS[statKey]) {\r\n            const factor = DIMINISHING_RETURN_STATS[statKey].denominator;\r\n            service.addDiminishingReturnStat(statKey, increase, factor);\r\n        } else {\r\n            service.addPercentageStat(statKey, increase);\r\n        }\r\n\r\n        const monsterType = isNormalDamage ? MONSTER_TYPE.NORMAL : MONSTER_TYPE.BOSS;\r\n        const newDPS = service.computeDPS(monsterType);\r\n        const gainPercentage = (newDPS - baseDPS) / baseDPS * 100;\r\n\r\n        const newValue = service.getStats()[statKey];\r\n        const oldValue = stats[statKey];\r\n\r\n        results.push({\r\n            statLabel: statKey,\r\n            increase,\r\n            oldDPS: baseDPS,\r\n            newDPS,\r\n            gainPercentage,\r\n            oldValue,\r\n            newValue\r\n        });\r\n    });\r\n\r\n    return results;\r\n}\r\n\r\n/**\r\n * Calculate all stat weights for predictions table\r\n * Returns structured data for both flat and percentage stats\r\n */\r\nexport function calculateAllStatWeights(\r\n    stats: StatsObject\r\n): {\r\n    baseBossDPS: number;\r\n    baseNormalDPS: number;\r\n    attackWeights: StatWeightResult[];\r\n    mainStatWeights: StatWeightResult[];\r\n    percentageWeights: Record<string, StatWeightResult[]>;\r\n} {\r\n    const baseService = new StatCalculationService(stats);\r\n    const baseBossDPS = baseService.baseBossDPS;\r\n    const baseNormalDPS = baseService.baseNormalDPS;\r\n\r\n    const attackWeights = calculateAttackWeights(stats, baseBossDPS, DEFAULT_STAT_INCREASES.flat);\r\n    const mainStatWeights = calculateMainStatWeights(stats, baseBossDPS, DEFAULT_STAT_INCREASES.mainStat);\r\n\r\n    // Calculate weights for all percentage stats\r\n    const percentageWeights: Record<string, StatWeightResult[]> = {};\r\n    PERCENTAGE_STATS.forEach(stat => {\r\n        percentageWeights[stat.key] = calculatePercentageStatWeight(\r\n            stats,\r\n            baseBossDPS,\r\n            baseNormalDPS,\r\n            stat.key,\r\n            DEFAULT_STAT_INCREASES.percentage\r\n        );\r\n    });\r\n\r\n    return {\r\n        baseBossDPS,\r\n        baseNormalDPS,\r\n        attackWeights,\r\n        mainStatWeights,\r\n        percentageWeights\r\n    };\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
