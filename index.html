<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Damage Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js/dist/tesseract.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            light: '#007aff',
                            dark: '#0a84ff'
                        },
                        secondary: {
                            light: '#5856d6',
                            dark: '#5e5ce6'
                        },
                        success: {
                            light: '#34c759',
                            dark: '#30d158'
                        },
                        warning: {
                            light: '#ff9500',
                            dark: '#ff9f0a'
                        }
                    }
                }
            }
        }
    </script>

    <!-- Force dark mode - light theme disabled -->
    <script>
        (function() {
            document.documentElement.classList.add('dark');
            localStorage.setItem('theme', 'dark');
            })();
    </script>

    <link rel="stylesheet" href="styles/styles.css">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GKDLXCWZ9R"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-GKDLXCWZ9R');
    </script>
</head>

<body class="bg-gray-50 dark:bg-black text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-300">
    <!-- Donation Message Notification -->
    <div id="donate-notification" class="donate-notification-theme" style="display: none; position: fixed; top: 80px; right: 20px; z-index: 1000; max-width: 400px; border-radius: 12px; padding: 16px 20px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); animation: slideIn 0.4s ease-out;">
        <div style="display: flex; align-items: start; gap: 12px;">
            <div style="font-size: 24px;">üíù</div>
            <div style="flex: 1;">
                <div style="font-weight: 600; font-size: 0.95em; line-height: 1.5; margin-bottom: 4px;">
                    Please consider supporting my efforts towards the calculator, what might seem small for you may be big for me :)!
                </div>
            </div>
            <button onclick="dismissDonateNotification()" class="donate-notification-close" style="border: none; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; font-size: 16px; line-height: 1; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">√ó</button>
        </div>
    </div>

    <!-- Sidebar Backdrop (for mobile) -->
    <div id="sidebar-backdrop" class="sidebar-backdrop" onclick="closeMobileMenu()"></div>

    <!-- Main Sidebar Navigation -->
    <aside id="app-sidebar" class="app-sidebar">
        <nav class="sidebar-nav">
            <!-- Loadout Section -->
            <button class="sidebar-nav-item" data-page="setup" onclick="toggleSubMenu('setup')">
                <span class="sidebar-icon">üéÆ</span>
                <span>Loadout</span>
                <span class="submenu-arrow">‚ñº</span>
            </button>
            <div class="sidebar-submenu" id="submenu-setup">
                <button class="sidebar-submenu-item" data-tab="base-stats" onclick="navigateToTab('setup', 'base-stats')">Base Stats</button>
                <button class="sidebar-submenu-item" data-tab="equipment" onclick="navigateToTab('setup', 'equipment')">Equipment</button>
                <button class="sidebar-submenu-item" data-tab="weapon-levels" onclick="navigateToTab('setup', 'weapon-levels')">Weapon Levels</button>
                <button class="sidebar-submenu-item" data-tab="companions" onclick="navigateToTab('setup', 'companions')">Companions</button>
            </div>

            <!-- Gear Lab Section -->
            <button class="sidebar-nav-item" data-page="optimization" onclick="toggleSubMenu('optimization')">
                <span class="sidebar-icon">üß™</span>
                <span>Gear Lab</span>
                <span class="submenu-arrow">‚ñº</span>
            </button>
            <div class="sidebar-submenu" id="submenu-optimization">
                <button class="sidebar-submenu-item" data-tab="item-comparison" onclick="navigateToTab('optimization', 'item-comparison')">Item Comparison</button>
                <button class="sidebar-submenu-item" data-tab="inner-ability" onclick="navigateToTab('optimization', 'inner-ability')">Inner Ability</button>
                <button class="sidebar-submenu-item" data-tab="artifact-potential" onclick="navigateToTab('optimization', 'artifact-potential')">Artifact Potential</button>
                <button class="sidebar-submenu-item" data-tab="scroll-optimizer" onclick="navigateToTab('optimization', 'scroll-optimizer')">Scrolling</button>
                <button class="sidebar-submenu-item" data-tab="cube-potential" onclick="navigateToTab('optimization', 'cube-potential')">Cube Potential</button>
                <button style="display: none;" class="sidebar-submenu-item" data-tab="stat-breakdown" onclick="navigateToTab('optimization', 'stat-breakdown')">Stat Breakdown</button>
            </div>

            <!-- StatHub Section -->
            <button class="sidebar-nav-item" data-page="predictions" onclick="toggleSubMenu('predictions')">
                <span class="sidebar-icon">üìä</span>
                <span >Stat Hub</span>
                <span class="submenu-arrow">‚ñº</span>
            </button>
            <div class="sidebar-submenu" id="submenu-predictions">
                <button class="sidebar-submenu-item" data-tab="stat-tables" onclick="navigateToTab('predictions', 'stat-tables')">Stat Predictions</button>
                <button class="sidebar-submenu-item" data-tab="equivalency" onclick="navigateToTab('predictions', 'equivalency')">Stat Equivalency</button>
            </div>
        </nav>

        <div class="sidebar-footer">
            <div class="sidebar-dps-summary">
                <span class="sidebar-dps-label">Current DPS</span>
                <span id="sidebar-dps-value" class="sidebar-dps-value">-</span>
            </div>
            <div class="sidebar-footer-actions">
                <button onclick="exportData()" class="sidebar-footer-btn">
                    <span>üìã</span>
                    <span>Copy</span>
                </button>
                <button onclick="importData()" class="sidebar-footer-btn">
                    <span>üì•</span>
                    <span>Paste</span>
                </button>
            </div>
            <button onclick="toggleTheme()" id="theme-toggle-sidebar" class="sidebar-footer-btn" style="display: none !important;">
                <span id="theme-icon-sidebar">üåô</span>
                <span>Toggle Theme</span>
            </button>
            <a href="https://paypal.me/freakehms" target="_blank" rel="noopener noreferrer" class="sidebar-footer-btn donate-btn">
                <span>üíù</span>
                <span>Support</span>
            </a>
        </div>
    </aside>

    <!-- Mobile Hamburger Button -->
    <button id="mobile-menu-btn" class="mobile-menu-btn" onclick="openMobileMenu()">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Help Sidebar Backdrop (for mobile) -->
    <div id="help-sidebar-backdrop" class="help-sidebar-backdrop" onclick="closeHelpSidebar()"></div>

    <!-- Help Sidebar -->
    <aside id="help-sidebar" class="help-sidebar" style="display: none;">
        <div class="help-sidebar-header">
            <h3 id="help-sidebar-title" class="help-sidebar-title">Help</h3>
            <button id="help-sidebar-close" class="help-close-btn" onclick="closeHelpSidebar()">&times;</button>
        </div>
        <div class="help-sidebar-content" id="help-sidebar-content">
            <!-- Dynamic help content goes here -->
        </div>
    </aside>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Page: Loadout -->
        <div id="page-setup" class="page-container">
        <!-- Loadout Content -->
        <div id="character-setup-card" class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-2xl p-3 shadow-lg mb-3">
            <div class="optimization-page-header">
                <h1 class="optimization-page-title">Loadout</h1>
            </div>
            <div class="optimization-main-tabs">
                <button class="setup-tab-button optimization-tab-button active" data-tab="base-stats" onclick="switchTabAndUpdateURL('setup', 'base-stats', event)">Base Stats</button>
                <button class="setup-tab-button optimization-tab-button" data-tab="equipment" onclick="switchTabAndUpdateURL('setup', 'equipment', event)">Equipment</button>
                <button class="setup-tab-button optimization-tab-button" data-tab="weapon-levels" onclick="switchTabAndUpdateURL('setup', 'weapon-levels', event)">Weapon Levels</button>
                <button class="setup-tab-button optimization-tab-button" data-tab="companions" onclick="switchTabAndUpdateURL('setup', 'companions', event)">Companions</button>
                <button style="display: none;" class="setup-tab-button optimization-tab-button" data-tab="artifacts" onclick="switchTabAndUpdateURL('setup', 'artifacts', event)">Artifacts</button>
            </div>

            <!-- Base Stats Tab -->
            <div id="setup-base-stats" class="setup-tab-content optimization-tab-content active">
                <!-- Content populated by base-stats-ui.js -->
            </div>

            <!-- Equipment Tab -->
            <div id="setup-equipment" class="setup-tab-content optimization-tab-content">
                <!-- Summary Section -->
                <div id="equipment-summary" class="equipment-summary-wrapper">
                    <h3 class="equipment-summary-title">Total Equipment Stats</h3>
                    <div id="equipment-summary-content" class="equipment-summary-content">
                        <span class="equipment-summary-empty">No equipment configured</span>
                    </div>
                </div>

                <!-- Equipment Slots Grid -->
                <div id="equipment-slots-container" class="equipment-slots-grid">
                    <!-- Equipment slots populated by JavaScript -->
                </div>
            </div>

            <!-- Weapon Levels Tab -->
            <div id="setup-weapon-levels" class="setup-tab-content optimization-tab-content">
                <!-- Content populated by weapon-levels-ui.ts -->
            </div>

            <!-- Companions Tab -->
            <div id="setup-companions" class="setup-tab-content optimization-tab-content">
                <div style="background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.05)); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px var(--shadow);">
                    <div style="color: var(--text-primary); font-size: 0.9em; line-height: 1.5;">
                        <strong style="color: var(--accent-primary);">Instructions:</strong> Click on a companion to unlock/activate it. Enter the level for each companion. Unlocked companions provide inventory effects (always active), and you can equip companions for additional equip effects. Worth noting that the active abilities or passives that occur when a companion is summoned is not accounted for in any of the values below when providing % gains in DPS. 
                    </div>
                </div>

                <!-- Summary Section -->
                <div id="companions-summary" style="background: var(--background); border: 2px solid var(--accent-primary); border-radius: 12px; padding: 10px 15px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                        <h3 style="color: var(--accent-primary); margin: 0; font-size: 1em; font-weight: 700;">Total Inventory Effects:</h3>
                        <div id="companions-summary-content" style="display: flex; flex-wrap: wrap; gap: 6px 10px; font-size: 0.85em; align-items: center;">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Companions Grid -->
                <div id="companions-grid-container" class="companions-main-layout">
                    <!-- Icon Grid, Detail Panel, and Presets populated by JS -->
                </div>
            </div>

            <!-- Artifacts Tab -->
            <div id="setup-artifacts" class="setup-tab-content optimization-tab-content">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; min-height: 600px;">
                    <!-- Left Panel: Equipped Artifacts -->
                    <div id="artifacts-equipped-panel" style="background: var(--background); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; overflow-y: auto;">
                        <!-- Populated by JavaScript -->
                    </div>

                    <!-- Center Panel: Detail Editor -->
                    <div id="artifacts-detail-panel" style="background: var(--background); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; overflow-y: auto;">
                        <!-- Populated by JavaScript -->
                    </div>

                    <!-- Right Panel: Artifact Grid -->
                    <div id="artifacts-grid-panel" style="background: var(--background); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; overflow-y: auto;">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        </div>
        <!-- End Page: Character Setup -->

        <!-- Page: Gear Lab -->
        <div id="page-optimization" class="page-container" style="display: none;">
        <!-- Gear Lab Content -->
        <div id="character-optimization-card" class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-2xl p-3 shadow-lg mb-3">
            <div class="optimization-page-header">
                <h1 class="optimization-page-title">Gear Lab</h1>
            </div>
            <div class="optimization-main-tabs">
                <button class="optimization-tab-button active" data-tab="item-comparison" onclick="switchTabAndUpdateURL('analysis', 'item-comparison', event); checkPendingSlotNavigation();">Item Comparison</button>
                <button class="optimization-tab-button" data-tab="inner-ability" onclick="switchTabAndUpdateURL('analysis', 'inner-ability', event)">Inner Ability</button>
                <button class="optimization-tab-button" data-tab="artifact-potential" onclick="switchTabAndUpdateURL('analysis', 'artifact-potential', event)">Artifact Potential</button>
                <button class="optimization-tab-button" data-tab="scroll-optimizer" onclick="switchTabAndUpdateURL('analysis', 'scroll-optimizer', event)">Scrolling</button>
                <button class="optimization-tab-button" data-tab="cube-potential" onclick="switchTabAndUpdateURL('analysis', 'cube-potential', event)">Cube Potential</button>
                <button style="display: none;" class="optimization-tab-button" data-tab="stat-breakdown" onclick="switchTabAndUpdateURL('analysis', 'stat-breakdown', event); updateStatBreakdown();">Stat Breakdown</button>
            </div>

            <!-- Item Comparison Tab - Enhanced UI/UX -->
            <div id="optimization-item-comparison" class="optimization-tab-content active">
                <!-- Slot Selector with Improved Visual Hierarchy -->
                <div class="comparison-slot-selector-wrapper">
                    <div class="comparison-slot-selector-inner">
                        <label for="comparison-slot-selector" class="comparison-slot-label">Equipment Slot</label>
                        <select id="comparison-slot-selector" onchange="switchComparisonSlot(this.value)" class="comparison-slot-select" aria-label="Select equipment slot to compare">
                            <option value="head">Head</option>
                            <option value="cape">Cape</option>
                            <option value="chest">Chest</option>
                            <option value="shoulders">Shoulders</option>
                            <option value="legs">Legs</option>
                            <option value="belt">Belt</option>
                            <option value="gloves">Gloves</option>
                            <option value="boots">Boots</option>
                            <option value="ring">Ring</option>
                            <option value="neck">Neck</option>
                            <option value="eye-accessory">Eye Accessory</option>
                        </select>
                    </div>
                </div>

                <!-- Two Column Layout with Improved Spacing -->
                <div class="comparison-columns-wrapper">
                    <!-- Equipped Item Card -->
                    <div class="comparison-column">
                        <h3 class="comparison-column-header comparison-column-header--equipped">Currently Equipped</h3>
                        <div class="equipped-item-card">
                            <div class="equipped-card-header">
                                <div class="equipped-card-title-row">
                                    <span class="equipped-card-title">Equipped Item</span>
                                    <span class="equipped-card-subtitle">(stats in base setup)</span>
                                </div>
                            </div>
                            <div class="equipped-inputs-row">
                                <div class="input-group equipped-input-group">
                                    <label for="equipped-name" class="equipped-label">Name</label>
                                    <input type="text" id="equipped-name" value="Current Item" onchange="saveToLocalStorage()" aria-label="Equipped item name" maxlength="50">
                                </div>
                                <div class="input-group equipped-input-group">
                                    <label for="equipped-attack" class="equipped-label">Attack</label>
                                    <input type="number" id="equipped-attack" value="0" onchange="saveToLocalStorage()" aria-label="Equipped item attack value">
                                </div>
                            </div>
                            <div id="equipped-stats-container" class="equipped-stats-container"></div>
                            <div class="equipped-actions-row">
                                <button onclick="addEquippedStat()" class="equipped-action-btn equipped-action-btn--add" aria-label="Add stat to equipped item">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                                    </svg>
                                    <span>Add Stat</span>
                                </button>
                                <button onclick="unequipItem()" class="equipped-action-btn equipped-action-btn--remove" aria-label="Unequip current item">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                                    </svg>
                                    <span>Unequip</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Comparison Items Column -->
                    <div class="comparison-column">
                        <h3 class="comparison-column-header comparison-column-header--comparison">Comparison Items</h3>
                        <!-- Tab Navigation with Enhanced Accessibility -->
                        <div id="comparison-tabs-container" class="comparison-tabs-container" role="tablist" aria-label="Comparison item tabs">
                            <button class="comparison-add-tab-btn" data-type="add-button" onclick="addComparisonItem()" aria-label="Add new comparison item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                                </svg>
                                <span>Add Item</span>
                            </button>
                        </div>
                        <!-- Comparison Items Content -->
                        <div id="comparison-items-container" class="comparison-items-container" role="presentation"></div>
                    </div>
                </div>

                <!-- Calculate Button with Enhanced Styling -->
                <button class="comparison-calculate-btn" onclick="calculate()" aria-label="Calculate damage for all comparison items">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                        <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                    </svg>
                    <span>Calculate All</span>
                </button>

                <!-- Results Section with Improved Visual Separation -->
                <div class="comparison-results-section">
                    <h3 class="comparison-results-title">Comparison Results</h3>
                    <div id="results-container" class="comparison-results-grid">
                        <!-- Results will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Inner Ability Analysis Tab -->
            <div id="optimization-inner-ability" class="optimization-tab-content">
                <!-- All inner HTML generated dynamically by TypeScript -->
            </div>

            <!-- Artifact Potential Tab -->
            <div id="optimization-artifact-potential" class="optimization-tab-content">
                <div id="artifact-potential-container">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Scroll Optimizer Tab -->
            <div id="optimization-scroll-optimizer" class="optimization-tab-content">
                <!-- Sub-tabs for Scrolling -->
                <div class="tab-navigation">
                    <button id="scrolling-tab-button" class="tab-button active" onclick="switchScrollingSubTab('my-slot-performance')">My Slot Performance</button>
                    <button id="scrolling-tab-button" class="tab-button" onclick="switchScrollingSubTab('simulation')">Simulation</button>
                </div>

                <!-- My Slot Performance Sub-Tab -->
                <div id="scrolling-my-slot-performance" class="scrolling-subtab active">
                    <!-- Will be populated by JavaScript -->
                </div>

                <!-- Simulation Sub-Tab -->
                <div id="scrolling-simulation" class="scrolling-subtab" style="display: none;">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Cube Potential Tab -->
            <div id="optimization-cube-potential" class="optimization-tab-content">
                <!-- Content populated by cube-potential-ui.ts -->
            </div>

            <!-- Stat Breakdown Tab -->
            <div id="optimization-stat-breakdown" class="optimization-tab-content">
                <div id="stat-breakdown-content">
                    <!-- Stat breakdown sections will be rendered here -->
                </div>
            </div>
        </div>
        </div>
        <!-- End Page: Character Optimization -->

        <!-- Page: Stat Hub -->
        <div id="page-predictions" class="page-container" style="display: none;">
        <!-- Stat Hub Content -->
        <div id="stat-damage-predictions-card" class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-2xl p-3 shadow-lg mb-3">
            <div class="optimization-page-header">
                <h1 class="optimization-page-title">
                    Stat Hub
                </h1>
            </div>

            <div class="optimization-main-tabs">
                <button class="predictions-tab-button optimization-tab-button active" data-tab="stat-tables" onclick="switchTabAndUpdateURL('predictions', 'stat-tables', event)">Stat Predictions</button>
                <button class="predictions-tab-button optimization-tab-button" data-tab="equivalency" onclick="switchTabAndUpdateURL('predictions', 'equivalency', event)">Stat Equivalency</button>
            </div>

            <!-- Stat Predictions Tab -->
            <div id="predictions-stat-tables" class="predictions-tab-content optimization-tab-content active">
                <div id="stat-weights"></div>
            </div>

            <!-- Stat Equivalency Tab -->
            <div id="predictions-equivalency" class="predictions-tab-content optimization-tab-content">
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--accent-primary); margin-bottom: 10px; font-size: 1.2em; font-weight: 600;">
                        ‚ú® Stat Equivalency Calculator
                    </h3>
                    <p style="color: var(--text-secondary); font-size: 0.9em; line-height: 1.6;">
                        Enter a value for any stat below to see what that gain translates to for all other stats. Perfect for comparing upgrade paths and understanding relative stat values.
                    </p>
                </div>
                <!-- Content will be dynamically generated by TypeScript -->
            </div>
        </div>
        </div>
        <!-- End Page: Stat Damage Predictions -->
    </div>
    <!-- End Main Content -->

    <!-- Import Map for cleaner imports -->
    <script type="importmap">
    {
        "imports": {
            "@core/": "./src/core/",
            "@ui/": "./src/ui/",
            "@utils/": "./src/ts/utils/",
            "@data/": "./src/ts/data/",
            "@services/" : "./src/ts/services/",
            "@page/": "./src/ts/page/",
            "@ts/": "./src/ts/",
            "@ts/types": "./src/ts/types/index.js"
        }
    }
    </script>

    <script type="module" src="./src/core/main.js"></script>
</body>

</html>
